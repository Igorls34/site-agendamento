{% extends 'bookings/profissional/base.html' %}

{% block title %}Dashboard - Profissional{% endblock %}

{% block header_title %}üìä Dashboard{% endblock %}
{% block header_subtitle %}Vis√£o geral de hoje{% endblock %}

{% block content %}
{% csrf_token %}

<!-- Estat√≠sticas R√°pidas -->
<div class="row g-2 mb-3">
    <div class="col-6">
        <div class="stat-card">
            <div class="stat-value text-primary">{{ agendamentos_hoje }}</div>
            <div class="stat-label">Hoje</div>
        </div>
    </div>
    <div class="col-6">
        <div class="stat-card">
            <div class="stat-value text-success">R$ {{ faturamento_semana|floatformat:2 }}</div>
            <div class="stat-label">Esta Semana</div>
        </div>
    </div>
</div>

<!-- Agendamentos Pendentes -->
{% if agendamentos_pendentes %}
<div class="card-mobile">
    <div class="card-body">
        <h6 class="card-title d-flex align-items-center">
            <i class="bi bi-exclamation-triangle text-warning me-2"></i>
            Aguardando Confirma√ß√£o ({{ agendamentos_pendentes|length }})
        </h6>
        
        {% for booking in agendamentos_pendentes %}
        <div class="agendamento-item pending">
            <div class="cliente-info">
                <div class="cliente-avatar">{{ booking.customer_name|first|upper }}</div>
                <div class="flex-grow-1">
                    <p class="cliente-name">{{ booking.customer_name }}</p>
                    <p class="cliente-phone">{{ booking.customer_phone }}</p>
                </div>
                <span class="status-badge status-pending">Pendente</span>
            </div>
            
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <small class="text-muted">{{ booking.service.name }}</small><br>
                    <strong>{{ booking.date|date:"d/m" }} √†s {{ booking.start_time|time:"H:i" }}</strong>
                </div>
                <div class="text-end">
                    <div class="text-success fw-bold">R$ {{ booking.service.price_real|floatformat:2 }}</div>
                </div>
            </div>
            
            <div class="quick-actions">
                <button class="btn btn-sm btn-success" onclick="updateStatus({{ booking.id }}, 'CONFIRMED')">
                    <i class="bi bi-check-lg"></i> Confirmar
                </button>
                <a href="{{ booking.whatsapp_url }}" class="btn btn-sm btn-whatsapp" target="_blank">
                    <i class="bi bi-whatsapp"></i> WhatsApp
                </a>
                <button class="btn btn-sm btn-outline-danger" onclick="updateStatus({{ booking.id }}, 'CANCELLED')">
                    <i class="bi bi-x-lg"></i>
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Pr√≥ximos Agendamentos de Hoje -->
{% if proximos_agendamentos %}
<div class="card-mobile">
    <div class="card-body">
        <h6 class="card-title d-flex align-items-center">
            <i class="bi bi-clock text-primary me-2"></i>
            Pr√≥ximos Agendamentos - {{ today|date:"d/m/Y" }}
        </h6>
        
        {% for booking in proximos_agendamentos %}
        <div class="agendamento-item {% if booking.status == 'CONFIRMED' %}confirmed{% else %}pending{% endif %}">
            <div class="cliente-info">
                <div class="cliente-avatar">{{ booking.customer_name|first|upper }}</div>
                <div class="flex-grow-1">
                    <p class="cliente-name">{{ booking.customer_name }}</p>
                    <p class="cliente-phone">{{ booking.customer_phone }}</p>
                </div>
                <span class="status-badge status-{{ booking.status|lower }}">{{ booking.get_status_display }}</span>
            </div>
            
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <small class="text-muted">{{ booking.service.name }}</small><br>
                    <strong class="text-primary">{{ booking.start_time|time:"H:i" }}</strong>
                </div>
                <div class="text-end">
                    <div class="text-success fw-bold">R$ {{ booking.service.price_real|floatformat:2 }}</div>
                </div>
            </div>
            
            <div class="quick-actions">
                {% if booking.status == 'PENDING' %}
                    <button class="btn btn-sm btn-success" onclick="updateStatus({{ booking.id }}, 'CONFIRMED')">
                        <i class="bi bi-check-lg"></i> Confirmar
                    </button>
                {% endif %}
                <a href="{{ booking.whatsapp_url }}" class="btn btn-sm btn-whatsapp" target="_blank">
                    <i class="bi bi-whatsapp"></i> Contatar
                </a>
                <a href="{% url 'profissional:agendamento_detail' booking.id %}" class="btn btn-sm btn-outline-primary">
                    <i class="bi bi-eye"></i> Ver
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

<!-- Quick Actions -->
<div class="card-mobile">
    <div class="card-body">
        <h6 class="card-title d-flex align-items-center">
            <i class="bi bi-lightning text-warning me-2"></i>
            A√ß√µes R√°pidas
        </h6>
        
        <div class="row g-2">
            <div class="col-6">
                <a href="{% url 'profissional:agenda' %}" class="btn btn-outline-primary btn-mobile w-100">
                    <i class="bi bi-calendar3 d-block mb-1"></i>
                    Ver Agenda
                </a>
            </div>
            <div class="col-6">
                <a href="{% url 'profissional:relatorios' %}" class="btn btn-outline-success btn-mobile w-100">
                    <i class="bi bi-graph-up d-block mb-1"></i>
                    Relat√≥rios
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Status do Sistema -->
<div class="card-mobile">
    <div class="card-body">
        <h6 class="card-title d-flex align-items-center">
            <i class="bi bi-info-circle text-info me-2"></i>
            Status do Sistema
        </h6>
        
        <div class="d-flex justify-content-between align-items-center">
            <span>Sistema</span>
            <span class="badge bg-success">Online</span>
        </div>
        <div class="d-flex justify-content-between align-items-center mt-2">
            <span>√öltima atualiza√ß√£o</span>
            <small class="text-muted">{{ today|date:"d/m/Y H:i" }}</small>
        </div>
    </div>
</div>

{% if not agendamentos_pendentes and not proximos_agendamentos %}
<div class="text-center py-5">
    <i class="bi bi-calendar-check text-muted" style="font-size: 3rem;"></i>
    <h5 class="text-muted mt-3">Tudo em dia!</h5>
    <p class="text-muted">Nenhum agendamento pendente no momento.</p>
    <a href="{% url 'profissional:agenda' %}" class="btn btn-primary btn-mobile">
        <i class="bi bi-calendar3 me-2"></i>Ver Agenda Completa
    </a>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
    // Auto-refresh da p√°gina a cada 2 minutos
    setTimeout(() => {
        location.reload();
    }, 120000);
    
    // Feedback visual para a√ß√µes
    document.addEventListener('click', function(e) {
        if (e.target.closest('.quick-actions button')) {
            e.target.innerHTML = '<i class="bi bi-hourglass-split"></i> Processando...';
        }
    });
</script>
{% endblock %}